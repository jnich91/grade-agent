# Ubuntu 24.04 base with apt; weâ€™ll add .NET, JDK 21, Maven
FROM mcr.microsoft.com/devcontainers/base:ubuntu-24.04

USER root

# Install Microsoft feed + .NET 8 SDK
RUN wget -qO /tmp/packages-microsoft-prod.deb https://packages.microsoft.com/config/ubuntu/24.04/packages-microsoft-prod.deb && \
    dpkg -i /tmp/packages-microsoft-prod.deb && rm /tmp/packages-microsoft-prod.deb && \
    apt-get update && \
    apt-get install -y --no-install-recommends dotnet-sdk-8.0 && \
    rm -rf /var/lib/apt/lists/*

# JDK 21 + Maven from Ubuntu repos (stable)
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      openjdk-21-jdk \
      maven \
      curl ca-certificates unzip zip jq wget git && \
    rm -rf /var/lib/apt/lists/*

    # after installing JDK (openjdk-21-jdk or temurin-21-jdk)
# auto-detect JAVA_HOME from javac, create a stable symlink, and export it
RUN set -e; \
    JHOME="$(dirname "$(dirname "$(readlink -f "$(command -v javac)")")")"; \
    echo "Detected JAVA_HOME=$JHOME"; \
    ln -s "$JHOME" /usr/lib/jvm/java || true; \
    printf 'export JAVA_HOME=/usr/lib/jvm/java\nexport PATH=$JAVA_HOME/bin:$PATH\n' > /etc/profile.d/java_home.sh

ENV JAVA_HOME=/usr/lib/jvm/java
ENV PATH=/usr/lib/jvm/java/bin:${PATH}

WORKDIR /work
USER vscode
